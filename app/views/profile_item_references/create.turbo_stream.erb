<% profile_item = @profile_item_reference.profile_item %>

<%= turbo_stream.replace "add_reference_message_#{profile_item.product_item_config.display_html.parameterize}" do %>
  <div id="add_reference_message_<%= @profile_item_reference.profile_item.product_item_config.display_html.parameterize %>" class="message-container">
    <%= @message %>
  </div>
<% end %>

<%= turbo_stream.replace "profile_item_references_#{profile_item.product_item_config.display_html.parameterize}" do %>
  <% profile_item.profile_item_references.each do |pif| %>
    <div>
      <p style="margin-bottom: 0">Reference: <%= pif.reference.title %></p>
      <p style="margin-bottom: 0">Annotation: <%= pif.annotation %></p>
      <div style="display: none" id="edit_reference_<%= pif.id %>">
        <%= render partial: 'profile_item_references/form', 
          locals: { 
            url: profile_item_reference_path(id: pif.id),
            method: :put,
            profile_item: profile_item,
            profile_item_reference: pif
          } %>
      </div> 
    </div>
  <% end %>
<% end %>

<%= turbo_stream.replace "add_reference_form_#{profile_item.product_item_config.display_html.parameterize}" do %>
  <div id="add_reference_form_<%= profile_item.product_item_config.display_html.parameterize %>" >
    <%= render partial: "profile_item_references/form", 
      locals: {
        url: profile_item_references_path,
        method: :post,
        profile_item: profile_item,
        instance_id: profile_item.instance_id,
        profile_item_reference: Profile::ProfileItemReference.new
      }  
    %>
  </div>
<% end %>