<%= form_with(model: loader_name, role: 'form', remote: true) do |f| %>
    <div class="form-group align-right">
      <% if loader_name.id.blank? %>
        <%= link_to 'Cancel', '/cancel-new-form', id: "loader-name-cancel",
          class: "btn btn-primary cancel-new-record-link",
          title: "Cancel new loader name",
          tabindex: increment_tab_index,
          data: {element_id: "new-loader-name-#{params[:random_id]}"} %>
      <% end %>
      <%= f.submit "Save", id: 'loader-name-save', class: 'btn btn-primary width-5em', title: "Save changes", tabindex: increment_tab_index, disabled: false %>
    <input type="hidden" name="random_id" value="<%= params[:random_id] %>"/>
    </div>
    <div id="search-result-details-info-message-container" class="message-container"></div>
    <div id="search-result-details-error-message-container" class="message-container"></div>

    <div class="form-group">
      <label for="seq">Seq*</label>
      <%= f.number_field(:seq, {class: 'form-control', title: 'For listing the taxon in the correct order', tabindex: increment_tab_index}) %>
    </div>

    <div class="form-group">
      <label for="simple_name">Simple Name*</label>
      <%= f.text_field :simple_name, class: 'form-control give-me-focus', required: true, title: "Enter simple name", tabindex: increment_tab_index, autofocus: true %>
    </div>

    <% unless loader_name.new_record? %>

      <div class="form-group">
        <label for="full_name">Full Name*</label>
        <%= f.text_field :full_name, class: 'form-control give-me-focus', required: true, title: "Enter full name", tabindex: increment_tab_index, autofocus: true %>
      </div>

    <% end %>
    
    <div class="form-group">
      <label for="rank">Rank</label>
      <%= f.text_field :rank, class: 'form-control', title: "Enter rank", tabindex: increment_tab_index, autofocus: true %>
    </div>

    <div class="form-group">
      <label for="record_type">Record type - synonym *</label>
      <%= f.select :record_type, ["synonym"], {include_blank: false},
        class: 'form-control',
        title: 'This is a synonym record, you cannot change that.',
        tabindex: increment_tab_index %>
    </div>

    <%= render partial: "loader/names/tabs/forms/synonym_type", locals: {f: f, loader_name: loader_name} %>

    <% unless loader_name.new_record? %>

    <div class="form-group">
      <label for="loader-name-parent-typeahead">Parent</label>
      <input id="loader-name-parent-typeahead"
             name="loader-name[parent_typeahead]"
             class="typeahead form-control"
             data-loader-name-id="<%= loader_name.id %>"
             data-loader-batch-id="<%= loader_name.loader_batch_id %>"
             type="text" 
             tabindex="<%= increment_tab_index %>"
             title="Raw loader name taxon that contains this loader name"
             value="<%= loader_name.parent.try('simple_name') %>"/>
     <p>If you change the parent, please also consider changing the seq field.</p>
    </div>
    <script>setUpLoaderNameParentTypeahead();</script>

    <% end %>
    <%= f.hidden_field(:parent_id, {}) %>

    <div class="form-group">
      <label for="family">Family*</label>
      <%= f.text_field :family, class: 'form-control give-me-focus', required: true, title: "Enter family name", tabindex: increment_tab_index, autofocus: true %>
    </div>

    <%= render partial: "loader/names/tabs/forms/name_status", locals: {f: f} %>
    <%#= render partial: "authors", locals: {f: f} %>

    <div class="form-group">
      <label for="notes">Notes</label>
      <%= f.text_area :notes, class: 'form-control', title: "Enter notes", tabindex: increment_tab_index, autofocus: true %>
    </div>

    <div class="form-group">
      <label for="remark_to_reviewers">Remark to reviewers</label>
      <%= f.text_area :remark_to_reviewers, class: 'form-control', title: "Enter remark to reviewers", tabindex: increment_tab_index, autofocus: true %>
    </div>

    <%= divider %>

    <% unless loader_name.id.blank? %>
        <% if loader_name&.preferred_match&.relationship_instance? %>
          <% disabled = true %>
          Note: this record already has an associated instance - you cannot switch off bulk processing while that relationship instance is attached.
        <% else %>
          <% disabled = false %>
        <% end %>

        <div class="form-group">
        <label class="form-check-label">
          <%= f.check_box(:no_further_processing, {class: 'xform-control',
                                                   disabled: disabled,
                                                   title: 'Prevent further bulk processing of this record.'}) %>
          Stop further bulk processing of this record
        </label>
        </div>
    <% end %>

    <%= f.submit "Save", id: 'loader-name-save', class: 'btn btn-primary width-5em pull-right', title: "Save changes", tabindex: increment_tab_index, disabled: false %>
    <div id="search-result-details-info-message-container2" class="message-container"></div>
    <div id="search-result-details-error-message-container2" class="message-container"></div>
<% end %>
